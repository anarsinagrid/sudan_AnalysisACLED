:root {
    --bg: #ffffff;
    --ink: #1a1a1a;
    --muted: #6b7280;
    --rule: #e5e7eb;
    --figure-bg: transparent;
    --accent: #2563eb;
    --scroll-progress: 0;
    --act-bg: var(--bg);
    --plotly-warm: #fbf7f0;

    /* Act background colors (very subtle) */
    --bg-hope: #edf3f7;
    --bg-tension: #efe3d6;
    --bg-rupture: #e6c6ad;
    --bg-aftermath: #e3ece6;
}

@supports (color: color-mix(in srgb, #fff 50%, #000 50%)) {
    :root {
        --plotly-warm: color-mix(in srgb, #ffffff 88%, var(--act-bg) 12%);
    }
}

/* ---------------- RESET ---------------- */

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

html {
    scroll-behavior: smooth;
}

body {
    background: var(--bg);
    color: var(--ink);
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
        Roboto, "Helvetica Neue", Arial, sans-serif;
    line-height: 1.7;
    font-size: 18px;
    -webkit-font-smoothing: antialiased;
    transition: background-color 1.2s ease;
}

body.show-footer {
    padding-bottom: 300px;
}

.act[data-act="aftermath"] {
    padding-bottom: 8rem;
}

/* Top scroll progress indicator (subtle, editorial) */
body::before {
    content: "";
    display: none;
}

/* Left timeline with jump markers */
.timeline {
    position: fixed;
    left: 16px;
    top: 50%;
    transform: translateY(-50%);
    height: 70vh;
    width: 66px;
    display: block;
    padding: 6px 0;
    z-index: 9000;
    pointer-events: none;
}

.timeline::before {
    content: "";
    position: absolute;
    top: 0;
    bottom: 0;
    left: 10px;
    width: 2px;
    background: rgba(26, 26, 26, 0.18);
    border-radius: 999px;
}

.timeline::after {
    content: "";
    position: absolute;
    top: 0;
    bottom: 0;
    left: 10px;
    width: 2px;
    background: rgba(26, 26, 26, 0.55);
    border-radius: 999px;
    transform-origin: top;
    transform: scaleY(var(--scroll-progress, 0));
    transition: transform 0.1s linear;
}

.timeline__dot {
    position: absolute;
    left: 18px;
    top: calc(var(--pos, 0) * 100%);
    transform: translateY(-50%);
    font-size: 1.02rem;
    letter-spacing: 0.1em;
    text-decoration: none;
    color: rgba(26, 26, 26, 0.55);
    font-weight: 700;
    padding: 5px 12px 5px 14px;
    border-radius: 999px;
    z-index: 1;
    pointer-events: auto;
    transition: color 0.2s ease, transform 0.2s ease, background-color 0.2s ease;
    cursor: pointer;
}

.timeline__dot:hover {
    color: rgba(26, 26, 26, 0.82);
    background: rgba(26, 26, 26, 0.06);
}

.timeline__dot.is-active {
    color: rgba(26, 26, 26, 0.85);
    transform: translateY(-50%) scale(1.03);
}

.timeline__dot:focus-visible {
    outline: 2px solid rgba(26, 26, 26, 0.55);
    outline-offset: 3px;
}

.timeline__dot--minor {
    display: none;
}

.timeline__dot--sub {
    left: 34px;
    font-size: 0.74rem;
    letter-spacing: 0.02em;
    padding: 2px 6px;
    color: rgba(26, 26, 26, 0.45);
    font-weight: 600;
}

.timeline__dot--sub:hover,
.timeline__dot--sub:focus-visible {
    color: rgba(26, 26, 26, 0.72);
}

/* ---------------- TEXT CONTAINER ---------------- */

.act {
    padding: 2rem 0;
}

.act[data-act="hope"] {
    padding-top: 1.5rem;
}

.act[data-act="rupture"] {
    padding-top: 1.5rem;
    padding-bottom: 1.5rem;
}

.act[data-act="rupture"] .text {
    padding-top: 1rem;
    padding-bottom: 1rem;
}

.act[data-act="rupture"] .figure.full {
    margin-top: 1.5rem;
    margin-bottom: 1.5rem;
    padding-top: 1.5rem;
    padding-bottom: 1.5rem;
}

.act[data-act="rupture"] h2 {
    margin: 1.2rem 0 0.8rem;
}

.act[data-act="rupture"] p {
    margin-bottom: 1rem;
}

.text {
    max-width: 760px;
    margin: 0 auto;
    padding: 1.5rem 1.5rem;
}

/* ---------------- TYPOGRAPHY ---------------- */

h1 {
    font-size: 2.5rem;
    font-weight: 700;
    line-height: 1.15;
    margin-bottom: 1rem;
    letter-spacing: -0.02em;
}

h2 {
    font-size: 1.75rem;
    font-weight: 600;
    line-height: 1.3;
    margin: 2rem 0 1.25rem;
    letter-spacing: -0.01em;
}

p {
    max-width: 65ch;
    margin-bottom: 1.4rem;
}

/* Subtitle */

.subtitle {
    font-size: 1.25rem;
    color: var(--muted);
    line-height: 1.5;
    margin-top: 0.5rem;
    margin-bottom: 2.25rem;
}

/* Intro guiding questions */
.intro-questions {
    margin-top: 1.25rem;
    padding: 1rem 1.1rem;
    background: rgba(255, 255, 255, 0.46);
    border: 1px solid rgba(26, 26, 26, 0.14);
    border-left: 4px solid rgba(26, 26, 26, 0.38);
    border-radius: 12px;
}

.intro-questions__kicker {
    font-size: 0.72rem;
    letter-spacing: 0.14em;
    text-transform: uppercase;
    color: rgba(26, 26, 26, 0.68);
    margin-bottom: 0.65rem;
    font-weight: 650;
}

.intro-questions__list {
    list-style: none;
    padding: 0;
    margin: 0;
    counter-reset: q;
}

.intro-questions__list li {
    margin: 0.55rem 0;
    font-size: 1.05rem;
    line-height: 1.35;
    font-weight: 600;
    color: rgba(26, 26, 26, 0.88);
    counter-increment: q;
}

.intro-questions__list li::before {
    content: "Q" counter(q);
    display: inline-block;
    width: 1.9rem;
    font-size: 0.82rem;
    letter-spacing: 0.06em;
    color: rgba(26, 26, 26, 0.52);
    transform: translateY(-0.04rem);
}

.intro-questions__meta {
    margin-top: 0.75rem;
    font-size: 0.9rem;
    line-height: 1.45;
    color: rgba(26, 26, 26, 0.72);
}

.figure-button {
    display: inline-block;
    margin-top: 0.4rem;
    padding: 0.45rem 0.85rem;
    background: rgba(26, 26, 26, 0.08);
    color: #1a1a1a;
    border-radius: 8px;
    text-decoration: none;
    font-size: 0.88rem;
    font-weight: 600;
    border: 1px solid rgba(26, 26, 26, 0.14);
    transition: background 0.2s ease, transform 0.15s ease;
}

.figure-button:hover,
.figure-button:focus-visible {
    background: rgba(26, 26, 26, 0.14);
    transform: translateY(-1px);
}

/* ---------------- ACT LABELS ---------------- */

.act-label {
    font-size: 0.75rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 0.75rem;
    font-weight: 500;
}

/* ---------------- SECTION DIVIDERS ---------------- */

.section-rule {
    max-width: 760px;
    margin: 2rem auto;
    height: 1px;
    background: var(--rule);
}

.section-rule.soft {
    margin: 1.25rem auto;
    opacity: 0.7;
}

.act .section-rule {
    display: none;
}

/* Reduce the gap between the title block and ACT I */
body>.section-rule:first-of-type {
    margin: 1.25rem auto;
}

/* ---------------- FIGURES ---------------- */

.figure.full {
    width: 100vw;
    margin-left: calc(-50vw + 50%);
    margin-top: 2rem;
    margin-bottom: 2rem;

    background: transparent;

    display: flex;
    flex-direction: column;
    align-items: center;

    padding: 1.5rem 1rem;

    /* scroll emphasis base state */
    opacity: 0.78;
    transform: translateY(8px);
    transition: opacity 0.6s ease, transform 0.6s ease;
}

.figure.full.is-active {
    opacity: 1;
    transform: translateY(0);
}

/* Plotly container */

.plotly-figure {
    width: 100%;
    max-width: 900px;
    height: auto;
    aspect-ratio: 16 / 9;
}

/* Charts only — keep transparent */
.figure.full:not(#fig-f6):not(#fig-f14) .plotly-figure .plot-container,
.figure.full:not(#fig-f6):not(#fig-f14) .plotly-figure .svg-container,
.figure.full:not(#fig-f6):not(#fig-f14) .plotly-figure .main-svg {
    background: transparent !important;
}

/* Only for non-map charts */
.figure.full:not(#fig-f6):not(#fig-f14) .plotly-figure .main-svg rect.bg {
    fill: transparent !important;
}

/* Gently warm only the map figures so they sit better on tinted acts */
#fig-f6 .plotly-figure .plot-container,
#fig-f14 .plotly-figure .plot-container,
#fig-f6 .plotly-figure canvas,
#fig-f14 .plotly-figure canvas {
    background: var(--plotly-warm) !important;
}

#fig-f6 .plotly-figure,
#fig-f14 .plotly-figure {
    filter: sepia(0.12) saturate(0.92) brightness(0.98) contrast(0.98);
    aspect-ratio: auto;
    height: 600px;
}

/* Timelapse controls emphasis */
#fig-f14 .plotly-figure .gupdatemenus .button rect {
    fill: rgba(255, 250, 240, 0.95) !important;
    stroke: #b45309 !important;
    stroke-width: 1.4px;
    rx: 6px;
    ry: 6px;
}

#fig-f14 .plotly-figure .gupdatemenus .button text {
    fill: #8b3700 !important;
    font-weight: 700;
    letter-spacing: 0.02em;
}

#fig-f14 .plotly-figure .gupdatemenus .button:hover rect,
#fig-f14 .plotly-figure .gupdatemenus .button:focus rect {
    fill: #ffe8c7 !important;
    stroke: #8b3700 !important;
}

#fig-f14 .plotly-figure .gupdatemenus {
    filter: drop-shadow(0 6px 12px rgba(0, 0, 0, 0.12));
    animation: pulse-hint 1.6s ease-in-out 2;
}

@keyframes pulse-hint {
    0% {
        transform: scale(1);
        opacity: 0.8;
    }

    50% {
        transform: scale(1.04);
        opacity: 1;
    }

    100% {
        transform: scale(1);
        opacity: 0.9;
    }
}

/* ---------------- CAPTIONS ---------------- */

.caption {
    max-width: 720px;
    margin-top: 1.25rem;
    font-size: 0.85rem;
    color: var(--muted);
    font-style: italic;
    text-align: center;
    line-height: 1.5;
}

.figure-explainer {
    margin-top: 0.65rem;
    padding: 0.65rem 0.9rem;
    background: rgba(26, 26, 26, 0.03);
    border-left: 3px solid rgba(26, 26, 26, 0.14);
    border-radius: 6px;
    font-size: 0.83rem;
    color: rgba(26, 26, 26, 0.76);
    text-align: left;
    font-style: normal;
}

/* legend interaction hint */
.legend-hint {
    display: inline-flex;
    align-items: center;
    margin-top: 0.6rem;
    padding: 0.3rem 0.6rem;
    border-radius: 999px;
    border: 1px solid rgba(37, 99, 235, 0.25);
    background: rgba(37, 99, 235, 0.12);
    font-style: normal;
    font-size: 0.72rem;
    font-weight: 600;
    letter-spacing: 0.02em;
    color: #1f2937;
}

/* ---------------- FOOTER ---------------- */

#footer-sentinel {
    height: 1px;
    width: 100%;
}

footer {
    position: fixed;
    left: 50%;
    bottom: 0;
    transform: translate(-50%, 120%);
    opacity: 0;
    pointer-events: none;
    transition: transform 0.45s ease, opacity 0.45s ease;
    z-index: 9500;

    width: min(900px, 92vw);
    margin: 0;
    padding: 1rem 1.25rem;
    font-size: 0.85rem;
    color: var(--muted);
    background: rgba(255, 255, 255, 0.94);
    border: 1px solid rgba(26, 26, 26, 0.12);
    border-radius: 14px;
    box-shadow: 0 14px 28px rgba(0, 0, 0, 0.12);
}

body.show-footer footer {
    transform: translate(-50%, -10px);
    opacity: 1;
    pointer-events: auto;
}

/* ---------------- RESPONSIVE ---------------- */

@media (max-width: 768px) {
    body {
        font-size: 16px;
    }

    .act {
        padding: 1.5rem 0;
    }

    .act[data-act="hope"] {
        padding-top: 1rem;
    }

    .act[data-act="rupture"] {
        padding-top: 1rem;
        padding-bottom: 1rem;
    }

    .act[data-act="rupture"] .text {
        padding-top: 0.75rem;
        padding-bottom: 0.75rem;
    }

    .text {
        padding: 1.25rem 1.25rem;
    }

    h1 {
        font-size: 2rem;
    }

    h2 {
        font-size: 1.5rem;
    }

    .figure.full {
        padding: 1rem 0.75rem;
        margin-top: 1.5rem;
        margin-bottom: 1.5rem;
    }

    .caption {
        padding: 0 1rem;
    }

    .timeline {
        left: 8px;
        height: 64vh;
        transform: translateY(-50%) scale(0.92);
    }
}

/* ---------------- PRINT ---------------- */

@media print {
    body::before {
        display: none;
    }

    .figure.full {
        page-break-inside: avoid;
        margin-left: 0;
        width: 100%;
    }
}

/* Animation Label */
.animation-label {
    display: table;
    margin: 2rem auto 0.75rem;
    font-weight: 700;
    font-size: 0.75rem;
    letter-spacing: 0.1em;
    color: var(--accent);
    text-transform: uppercase;
    text-align: center;
    border: 1px solid rgba(214, 48, 49, 0.4);
    padding: 0.35rem 0.65rem;
    border-radius: 4px;
    background: rgba(214, 48, 49, 0.04);
}

.animation-note {
    margin: 1.5rem auto;
    padding: 1rem 1.25rem;
    border: 1px solid var(--rule);
    border-left: 4px solid var(--accent);
    background: rgba(37, 99, 235, 0.06);
    border-radius: 10px;
}

.animation-note__kicker {
    font-size: 0.7rem;
    letter-spacing: 0.14em;
    text-transform: uppercase;
    font-weight: 700;
    color: var(--accent);
    margin-bottom: 0.5rem;
}

.animation-note__lede {
    margin-bottom: 0.75rem;
}

.animation-note__list {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 0.5rem 1rem;
    padding: 0;
    margin: 0;
    list-style: none;
}

.animation-note__list li {
    margin: 0;
    padding-left: 0.9rem;
    position: relative;
}

.animation-note__list li::before {
    content: "•";
    position: absolute;
    left: 0;
    top: 0;
    color: var(--accent);
    font-weight: 700;
}
